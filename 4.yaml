# mihomo (Clash Meta) 懒人配置
# 版本 V1.8-240904
# https://gist.github.com/liuran001/5ca84f7def53c70b554d3f765ff86a33

pr:
  &pr {
    type: select,
    proxies:
      [节点选择,港台,DIRECT 
      ]
  }
# 延迟检测 URL
p: &p
  type: http
  # 自动更新订阅时间，单位为秒
  interval: 3600
  health-check:
    enable: true
    url: https://cp.cloudflare.com
    # 节点连通性检测时间，单位为秒
    interval: 900
    # 节点超时延迟，单位为毫秒
    timeout: 1000
    # 节点自动切换差值，单位为毫秒
    tolerance: 30


use: &use
  # 如果不希望自动切换请将下面两行注释对调
  # type: select
  type: url-test
  use:
    - 订阅ouo
    - 订阅infini
    - 订阅魔戒

    - 订阅极速
    - 订阅顶极 
    - 订阅一毛 
    # - 本地配置

# 订阅链接
# 对于订阅来说，path 为选填项，但建议启用
# 本地配置可以只填 path
proxy-providers:
  订阅ouo:
    <<: *p
    # path: ./proxy_provider/订阅ouo.yaml
    url: "https://subs.ouoboom.xyz/api/v1/client/subscribe?token=ec27610d7616aebf0638ac248272e30c"


  订阅infini:
    <<: *p
    # path: ./proxy_provider/订阅infini.yaml
    url: "http://on1vejas4m6z.w7yxefcx0i11.click/api/v1/client/subscribe?token=3ab9d7bb8db9d14f97c6471b50e795ad"    

  订阅魔戒:
    <<: *p
    # path: ./proxy_provider/订阅魔戒.yaml
    url: "https://onlysub.mjurl.com/api/v1/client/subscribe?token=be63ca898f4dc9dc324da74cbbd169d0" 

 

  订阅极速:
    <<: *p
    # path: ./proxy_provider/订阅极速.yaml
    url: "https://jsjc.cfd/api/v1/client/subscribe?token=38dad4d94433c89a02a71b7b9d4590cc"        

  订阅顶极:
    <<: *p
    # path: ./proxy_provider/订阅顶极.yaml
    url: "https://platform.djjc.cfd/api/v1/client/subscribe?token=a5c350e5484ec4dbbec597289750a7a2"        

  订阅一毛:
    <<: *p
    # path: ./proxy_provider/订阅一毛.yaml
    url: "https://ymjc.cfd/api/v1/client/subscribe?token=4dbb877715ee1d9caede1e235be15136"  
           

  # 本地配置:
    # <<: *p
    # path: ./proxy_provider/本地配置.yaml



# 规则订阅
rule-providers:
  # anti-AD 广告拦截规则
  # https://github.com/privacy-protection-tools/anti-AD
  # 如果误杀率高请自行更换

  rule1:
    type: http
    behavior: domain
    format: yaml
    # path可为空(仅限clash.meta 1.15.0以上版本)
    path: ./rule_provider/rule1.yaml
    url: "https://raw.githubusercontent.com/motorar/rule/refs/heads/main/rule1.yaml?token=GHSAT0AAAAAADFO3TFHUM2XID4YQAFPOVEE2CJHWUQ"
    interval: 3600

  easylist:
    type: http
    behavior: domain
    format: yaml
    # path可为空(仅限clash.meta 1.15.0以上版本)
    path: ./rule_provider/easylist.yaml
    url: "https://easylist.to/easylist/easylist.txt"
    interval: 3600    


  anti-AD:
    type: http
    behavior: domain
    format: yaml
    # path可为空(仅限clash.meta 1.15.0以上版本)
    path: ./rule_provider/anti-ad-clash.yaml
    url: "https://raw.githubusercontent.com/privacy-protection-tools/anti-AD/master/anti-ad-clash.yaml"
    interval: 3600
  # anti-AD 白名单规则
  anti-AD-white:
    type: http
    behavior: domain
    format: yaml
    # path可为空(仅限clash.meta 1.15.0以上版本)
    path: ./rule_provider/anti-AD-white.yaml
    url: "https://raw.githubusercontent.com/privacy-protection-tools/dead-horse/master/anti-ad-white-for-clash.yaml?"
    interval: 3600


mode: rule
# ipv6 支持
ipv6: true
log-level: info
# 允许局域网连接
allow-lan: true
# socks5/http 端口
mixed-port: 7890
# Meta 内核特性 https://wiki.metacubex.one/config/general
# 统一延迟
# 更换延迟计算方式,去除握手等额外延迟
unified-delay: true
# TCP 并发
# 同时对所有ip进行连接，返回延迟最低的地址
tcp-concurrent: true
# 外部控制端口
external-controller: :9090

geodata-mode: true

# Geo 数据库下载地址
# 使用 FastGit 代理 (https://fgit.cf)
# 源地址 https://github.com/MetaCubeX/meta-rules-dat
# 可以更换镜像站但不要更换其他数据库，可能导致无法启动
geox-url:
  geoip: "https://github.com/Loyalsoldier/v2ray-rules-dat/releases/latest/download/geoip.dat"
  geosite: "https://github.com/Loyalsoldier/v2ray-rules-dat/releases/latest/download/geosite.dat"
  mmdb: "https://hub.gitmirror.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/country.mmdb"

# 进程匹配模式
# 路由器上请设置为 off
# always 开启，强制匹配所有进程
# strict 默认，由 Clash 判断是否开启
# off 不匹配进程，推荐在路由器上使用此模式
find-process-mode: strict

# 缓解移动设备耗电问题
# https://github.com/vernesong/OpenClash/issues/2614
keep-alive-interval: 1800

# 全局客户端指纹
global-client-fingerprint: random # 随机指纹

# 缓存
profile:
  store-selected: true
  store-fake-ip: true

# 自动同步时间以防止时间不准导致无法正常联网
ntp:
  enable: true
  # 是否同步至系统时间，需要 root/管理员权限
  write-to-system: false
  server: time.apple.com
  port: 123
  interval: 900   # 原始是30

# 域名嗅探
sniffer:
  enable: true
  sniff:
    TLS:
      ports: [443, 8443]
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true

# tun 模式
tun:
  enable: false  # enable 'true'
  stack: system  # or 'gvisor'
  dns-hijack:
    - "any:53"
    - "tcp://any:53"
  auto-route: true
  auto-detect-interface: true

# dns 设置
# 已配置 ipv6
dns:
  enable: false
  listen: :1053
  ipv6: true
  # 路由器个人建议使用 redir-host 以最佳兼容性
  # 其他设备可以使用 fake-ip
  enhanced-mode: redir-host
  fake-ip-range: 28.0.0.1/8
  fake-ip-filter:
    - '*'
    - '+.lan'
    - '+.local'
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
    - 114.114.114.114
    - '[2402:4e00::]'
    - '[2400:3200::1]'
  nameserver:
    - 'tls://8.8.4.4#dns'
    - 'tls://1.0.0.1#dns'
    - 'tls://[2001:4860:4860::8844]#dns'
    - 'tls://[2606:4700:4700::1001]#dns'
  proxy-server-nameserver:
    - https://doh.pub/dns-query
  nameserver-policy:
    "geosite:cn,private":
      - https://doh.pub/dns-query
      - https://dns.alidns.com/dns-query

# 多入站端口设置


proxies:

  #   dns:
  #     - https://dns.cloudflare.com/dns-query

proxy-groups:
  # 使用 WARP 的用户需要手动在下方的 proxies 字段内添加 WARP
  # 例如 [WARP, 全部节点, 自动选择, 香港, 台湾, 日本, 新加坡, 美国, 其它地区, DIRECT],
  - {
      name: 节点选择,
      type: url-test,
       <<: *use,  filter: "(?i)Hong kong|Singapore|Taiwan|Japan|香港2号|抖音|香港HY-优化2|US 01 S"}
  - { name: robin,   type: "load-balance",
            strategy: "round-robin", proxies: [ 港台,新日,极速,顶极,一毛]}           

 

  - { name: Ouo, type: url-test,  use: [订阅ouo] }
  - { name: 极速, type: url-test,   use:  [订阅极速] }    
  - { name: 顶极, type: url-test,   use:  [订阅顶极] }   
  - { name: 一毛, type: url-test,   use:  [订阅一毛] }   
 # 分隔,下面是地区分组
  - { name: 港台, <<: *use, type: url-test, filter: "(?i)台湾|香港|韩国|美国高速",  exclude-filter: "wap|WAP|HY|-优化|GPT"}  
  - { name: 新日, <<: *use, type: url-test, filter: "(?i)新加坡|日本|美国专线", exclude-filter: "wap|WAP|HY|-优化|GPT"}
  
  - { name: Ouo新2, <<: *use,   type: url-test, filter: "(?i)Singapore 01|Singapore 02|Singapore 03" }    
  - { name: 美国, <<: *use,   type: url-test, filter: "(?i)美国|圣何塞|洛杉矶", exclude-filter: "wap|WAP|HY|-优化|GPT|0.1" }    
  - { name: 英国, <<: *use,   type: url-test, filter: "(?i)英国|Britain|UK" }      

rules:
  # 若需禁用 QUIC 请取消注释 QUIC 两条规则
  # 防止 YouTube 等使用 QUIC 导致速度不佳, 禁用 443 端口 UDP 流量（不包括国内）

# - AND,(AND,(DST-PORT,443),(NETWORK,UDP)),(NOT,((GEOSITE,cn))),REJECT # quic

# - GEOSITE,biliintl,哔哩东南亚
# - GEOSITE,bilibili,哔哩哔哩

  
  - RULE-SET,rule1,REJECT
  - RULE-SET,easylist,REJECT  
# - AND,(AND,(DST-PORT,443),(NETWORK,UDP)),(NOT,((GEOSITE,cn))),REJECT # quic
  - AND,((RULE-SET,anti-AD),(NOT,((RULE-SET,anti-AD-white)))),REJECT # 感谢 Telegram @nextyahooquery 提供的建议

  - DOMAIN-SUFFIX,downloadtorrentfile.com,极速
  - DOMAIN-KEYWORD,torrent,极速
  - DOMAIN-KEYWORD,amg00488-foxdigital-newsnow,美国
  - DOMAIN-KEYWORD,vs-hls-pushb-uk-live,英国  

  - DOMAIN-SUFFIX,cloudfront.net,robin
  - DOMAIN-SUFFIX,akamaized.net,robin
  - DOMAIN-SUFFIX,warnermediacdn.com,robin
  - DOMAIN-SUFFIX,cbsnews.com,robin
  
  - DOMAIN-SUFFIX,amagi.tv,robin
  - DOMAIN-SUFFIX,moveonjoy.com,robin
  - DOMAIN-SUFFIX,wurl.tv,robin
  - DOMAIN-SUFFIX,getaj.net,robin
  - DOMAIN-SUFFIX,pbskids.org,robin
  - DOMAIN-SUFFIX,corusdigitaldev.com,robin
  - DOMAIN-SUFFIX,rttv.com,robin

  - DOMAIN-SUFFIX,googlevideo.com,节点选择   # YouTube

  - DOMAIN-SUFFIX,pluto.tv,美国
  - DOMAIN-SUFFIX,plutotv.net,美国     
  
  - DOMAIN-SUFFIX,tubi.video,美国  
  - DOMAIN-SUFFIX,iptvcat.com,顶极


  - GEOSITE,ehentai,REJECT

  - DOMAIN-SUFFIX,oochat.space,Ouo新2



  - GEOSITE,youtube,节点选择
  - GEOSITE,google,节点选择
  - GEOSITE,google-cn,节点选择 # Google CN 不走代理会导致香港等地区节点 Play Store 异常

  - GEOSITE,twitter,节点选择


  - GEOSITE,steam@cn,DIRECT
  - GEOSITE,steam,节点选择
  - GEOSITE,onedrive,节点选择
  - GEOSITE,microsoft,节点选择
  - GEOSITE,geolocation-!cn,节点选择
# - AND,(AND,(DST-PORT,443),(NETWORK,UDP)),(NOT,((GEOIP,CN))),REJECT # quic




  - GEOSITE,CN,DIRECT

  - MATCH,节点选择
